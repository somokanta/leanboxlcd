<?php

/**
 * Implements hook_menu
 */
function leanbox_pod_menu() {
   $items = array();
   $items['pod-threshold'] = array(
     'title' => 'Pod Threshold',
     'page callback' => 'drupal_get_form',
     'page arguments' => array('_set_pod_threshold_callback'),
     'access arguments' => array('pod threshold'),
     'type' => MENU_CALLBACK,
     'file' => 'form/leanbox_pod.form.inc',
   );
   return $items;
}

/**
 * Implement hook_permission()
 *  Add custom permission Central sales delivery report
 */
function leanbox_pod_permission() {
   return array(
     'pod threshold' => array(
       'title' => t('pod threshold'),
       'description' => t('pod threshold')
     )
   );
}

/**
 * 
 * @param type $dis_id
 * @return int
 */
function _get_pod_threshold_value($dis_id) {
   $query = db_select('pod_flat_table', 'pt');
   $query->fields('pt', array('pod_threshold'));
   $query->condition('pt.distributor_id', $dis_id);
   $user_pod_value = $query->execute()->fetchField();
   return $user_pod_value;
}

/**
 * Implements hook_taxonomy_term_presave($term)
 * @param type $term
 */
function leanbox_pod_taxonomy_term_presave($term) {
   if ($term->vocabulary_machine_name === 'pod_call_status') {
      $user_id = $GLOBALS['user']->uid;
      $distributor_id = change_feeds_import_get_distributor_id($user_id);
      $term->field_call_status_user['und'][0]['uid'] = $distributor_id;
   }
   if ($term->vocabulary_machine_name === 'pod_delivery_status') {
      $user_id = $GLOBALS['user']->uid;
      $distributor_id = change_feeds_import_get_distributor_id($user_id);
      $term->field_delivery_status_user['und'][0]['uid'] = $distributor_id;
   }
}
